"""Comprehensive test for TVS diode component matching."""

load("../../generics/Tvs.zen", "Package", "Direction")
load("../../interfaces.zen", "Power", "Ground")
load("../../units.zen", "VoltageRange")
load("../match_generics.zen", "assign_house_parts")

Tvs = Module("../../generics/Tvs.zen")

gnd = Ground("GND")
vcc = Power("VCC", voltage=VoltageRange("3.3V"))

# Test cases: (direction, package, reverse_standoff_voltage)
TVS_TEST_CASES = [
    # Unidirectional DO-219AB
    ("Unidirectional", "DO-219AB", "3.3V"),
    ("Unidirectional", "DO-219AB", "5V"),
    ("Unidirectional", "DO-219AB", "20V"),
    ("Unidirectional", "DO-219AB", "24V"),
    # Unidirectional DO-214AC (SMA)
    ("Unidirectional", "DO-214AC", "20V"),
    ("Unidirectional", "DO-214AC", "24V"),
    # Unidirectional DO-214AA (SMB)
    ("Unidirectional", "DO-214AA", "28V"),
    ("Unidirectional", "DO-214AA", "33V"),
    # Bidirectional DO-214AC (SMA)
    ("Bidirectional", "DO-214AC", "15V"),
    ("Bidirectional", "DO-214AC", "33V"),
    ("Bidirectional", "DO-214AC", "60V"),
    # Bidirectional DO-214AA (SMB)
    ("Bidirectional", "DO-214AA", "40V"),
    # Bidirectional DO-214AB (SMC)
    ("Bidirectional", "DO-214AB", "24V"),
]

for id, (direction, package, standoff_voltage) in enumerate(TVS_TEST_CASES):
    if direction == "Unidirectional":
        Tvs(
            name=f"D{id}",
            direction=direction,
            package=package,
            reverse_standoff_voltage=VoltageRange(standoff_voltage),
            A=gnd,
            K=vcc,
        )
    else:
        Tvs(
            name=f"D{id}",
            direction=direction,
            package=package,
            reverse_standoff_voltage=VoltageRange(standoff_voltage),
            A=Net(f"LINE_A_{id}"),
            K=Net(f"LINE_B_{id}"),
        )

builtin.add_component_modifier(assign_house_parts)
