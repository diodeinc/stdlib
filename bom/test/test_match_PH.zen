"""Comprehensive test for PinHeader component."""

load("../../generics/PinHeader.zen", "Mount", "Pitch", "Orientation", "Gender")
load("../match_generics.zen", "assign_house_parts")

PinHeader = Module("../../generics/PinHeader.zen")

# SMD 2.54mm
PH_SMD_SINGLE_ROW_PINS = [4, 6, 10, 14, 16, 24, 32]
PH_SMD_DUAL_ROW_PINS = [2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 16, 17, 18]

# THT 2.54mm
PH_THT_254_SINGLE_ROW_PINS = [2, 3, 4, 5, 6, 8, 10, 15]
PH_THT_254_DUAL_ROW_PINS = [2, 3, 4, 5, 10, 20]

# THT 1.27mm
PH_THT_127_DUAL_ROW_PINS = [2, 4, 5, 10]

PH_HOUSE_PARTS = (
    [
        # 2.54mm SMD
        (pitch, rows, pins, orientation, gender, mount)
        for pitch in ["2.54mm"]
        for rows in [1, 2]
        for pins in {1: PH_SMD_SINGLE_ROW_PINS, 2: PH_SMD_DUAL_ROW_PINS}[rows]
        for orientation in ["Vertical"]
        for gender in ["Male"]
        for mount in ["SMD"]
    ]
    + [
        # 2.54mm THT
        (pitch, rows, pins, orientation, gender, mount)
        for pitch in ["2.54mm"]
        for rows in [1, 2]
        for pins in {1: PH_THT_254_SINGLE_ROW_PINS, 2: PH_THT_254_DUAL_ROW_PINS}[rows]
        for orientation in ["Vertical"]
        for gender in ["Male"]
        for mount in ["THT"]
    ]
    + [
        # 1.27mm THT (2 rows only)
        ("1.27mm", 2, pins, "Vertical", "Male", "THT")
        for pins in PH_THT_127_DUAL_ROW_PINS
    ]
)

for id, (pitch, rows, pins, orientation, gender, mount) in enumerate(PH_HOUSE_PARTS):
    pitch_str = pitch.replace(".", "_")
    gender_str = gender
    orientation_str = orientation
    mount_str = mount
    nets = {f"P{n}": Net(f"PH{id}_{n}") for n in range(1, pins * rows + 1)}
    PinHeader(
        name=f"PH_{id}",
        mount=mount,
        pins=pins,
        rows=rows,
        orientation=orientation,
        pitch=pitch,
        gender=gender,
        **nets,
    )

builtin.add_component_modifier(assign_house_parts)
